<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facial Booking â€“ Home</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="js/api.js"></script>
</head>
<body>
    <div class="auth-wrapper">
        <h1>Facial Booking System</h1>
        <p>Loading...</p>
    </div>

    <script>
        $(function () {
            const token = fbGetToken();
            
            // Default to login page if no token
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            // If token exists, verify it's valid and redirect accordingly
            fbFetchProfile()
                .done(function(res) {
                    const user = res.user;
                    
                    // If user is not verified, clear token and redirect to login
                    // The login page will handle redirecting to verification if needed
                    if (!user.email_verified_at) {
                        fbSetToken(''); // Clear unverified token
                        window.location.href = 'login.html';
                        return;
                    }
                    
                    // User is verified - redirect to their dashboard
                    fbRedirectByRole(user);
                })
                .fail(function(xhr) {
                    // Token is invalid or expired - clear it and go to login
                    fbSetToken('');
                    window.location.href = 'login.html';
                });
        });
    </script>
</body>
</html>

